(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{8055:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,9324,23)),Promise.resolve().then(n.bind(n,9329)),Promise.resolve().then(n.bind(n,7228)),Promise.resolve().then(n.t.bind(n,8173,23)),Promise.resolve().then(n.t.bind(n,468,23))},9329:(e,t,n)=>{"use strict";n.d(t,{default:()=>u});var r=n(5155),l=n(4775),a=n(8473);function i(e){let{client:t,children:n}=e;return(0,r.jsx)(l.N2,{client:t,useAuth:a.As,children:n})}let o=new l.eH("https://blessed-zebra-623.convex.cloud");function u(e){let{children:t}=e;return(0,r.jsx)(i,{client:o,children:t})}},5828:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return a},findSourceMapURL:function(){return l.findSourceMapURL}});let r=n(9603),l=n(3355),a=n(4979).createServerReference},9324:()=>{},468:e=>{e.exports={style:{fontFamily:"'myFont', 'myFont Fallback'"},className:"__className_8bdc3a"}},7228:(e,t,n)=>{"use strict";n.d(t,{ConvexAuthNextjsClientProvider:()=>u});var r=n(5155),l=n(2115),a=n(8473),i=n(5828);let o=(0,i.createServerReference)("008fa9bcf22b32e7e3a284e2b31572c964f110dbe5",i.callServer,void 0,i.findSourceMapURL,"invalidateCache");function u(e){let{apiRoute:t,serverState:n,storage:i,storageNamespace:u,verbose:s,children:c}=e,d=(0,l.useCallback)(async(e,n)=>{let r=await fetch(null!=t?t:"/api/auth",{body:JSON.stringify({action:e,args:n}),method:"POST"});return await r.json()},[t]),h=(0,l.useMemo)(()=>({authenticatedCall:d,unauthenticatedCall:d,verbose:s}),[d,s]);return(0,r.jsx)(a.OJ,{client:h,serverState:n,onChange:o,storage:"undefined"==typeof window?void 0:"inMemory"===i?null:window.localStorage,storageNamespace:null!=u?u:function(e,t){if(void 0===e)throw Error("Missing environment variable `".concat(t,"`"));return e}("https://blessed-zebra-623.convex.cloud","NEXT_PUBLIC_CONVEX_URL"),replaceURL:e=>{window.history.replaceState({},"",e)},children:c})}},8473:(e,t,n)=>{"use strict";n.d(t,{As:()=>o,OJ:()=>v,eB:()=>a});var r=n(5155),l=n(2115);let a=(0,l.createContext)(void 0),i=(0,l.createContext)(void 0);function o(){return(0,l.useContext)(i)}let u=(0,l.createContext)(null),s="__convexAuthOAuthVerifier",c="__convexAuthJWT",d="__convexAuthRefreshToken",h="__convexAuthServerStateFetchTime";function v({client:e,serverState:t,onChange:n,storage:o,storageNamespace:v,replaceURL:w,children:g}){let b=(0,l.useRef)(t?._state.token??null),[m,_]=(0,l.useState)(null===b.current),[S,x]=(0,l.useState)(b.current),C=e.verbose??!1,p=(0,l.useCallback)(e=>{C&&console.debug(`${new Date().toISOString()} ${e}`)},[C]),{storageSet:A,storageGet:R,storageRemove:P,storageKey:M}=function(e,t){let n=function(){let[e,t]=(0,l.useState)({});return()=>({getItem:t=>e[t],setItem:(e,n)=>{t(t=>({...t,[e]:n}))},removeItem:e=>{t(t=>{let{[e]:n,...r}=t;return r})}})}(),r=(0,l.useMemo)(()=>e??n(),[e]),a=t.replace(/[^a-zA-Z0-9]/g,""),i=(0,l.useCallback)(e=>`${e}_${a}`,[t]);return{storageSet:(0,l.useCallback)((e,t)=>r.setItem(i(e),t),[r,i]),storageGet:(0,l.useCallback)(e=>r.getItem(i(e)),[r,i]),storageRemove:(0,l.useCallback)(e=>r.removeItem(i(e)),[r,i]),storageKey:i}}(o,v),[I,E]=(0,l.useState)(!1),O=(0,l.useCallback)(async e=>{let t;let r=null!==b.current;if(null===e.tokens)b.current=null,e.shouldStore&&(await P(c),await P(d)),t=null;else{let{token:n}=e.tokens;if(b.current=n,e.shouldStore){let{refreshToken:t}=e.tokens;await A(c,n),await A(d,t)}t=n}r!==(null!==t)&&await n?.(),x(t),_(!1)},[A,P]);(0,l.useEffect)(()=>{let e=async e=>{if(I)return e.preventDefault(),e.returnValue=!0,"Are you sure you want to leave? Your changes may not be saved."};return k("beforeunload",e),()=>{y("beforeunload",e)}}),(0,l.useEffect)(()=>{let e=e=>{(async()=>{if(e.storageArea===o&&e.key===M(c)){let t=e.newValue;p(`synced access token, is null: ${null===t}`),await O({shouldStore:!1,tokens:null===t?null:{token:t}})}})()};return k("storage",e),()=>y("storage",e)},[O]);let L=(0,l.useCallback)(async t=>{let{tokens:n}=await e.unauthenticatedCall("auth:signIn","code"in t?{params:{code:t.code},verifier:t.verifier}:t);return p(`retrieved tokens, is null: ${null===n}`),await O({shouldStore:!0,tokens:n??null}),null!==n},[e,O]),N=(0,l.useCallback)(async(t,n)=>{let r=n instanceof FormData?Array.from(n.entries()).reduce((e,[t,n])=>(e[t]=n,e),{}):n??{},l=await R(s)??void 0;await P(s);let a=await e.authenticatedCall("auth:signIn",{provider:t,params:r,verifier:l});if(void 0!==a.redirect){let e=new URL(a.redirect);return await A(s,a.verifier),void 0!==window.location&&(window.location.href=e.toString()),{signingIn:!1,redirect:e}}if(void 0!==a.tokens){let{tokens:e}=a;return p(`signed in and got tokens, is null: ${null===e}`),await O({shouldStore:!0,tokens:e}),{signingIn:null!==a.tokens}}return{signingIn:!1}},[e,O,R]),T=(0,l.useCallback)(async()=>{try{await e.authenticatedCall("auth:signOut")}catch(e){}p("signed out, erasing tokens"),await O({shouldStore:!0,tokens:null})},[O,e]),j=(0,l.useCallback)(async({forceRefreshToken:e})=>{if(e){let e=b.current;return await f(d,async()=>{let t=b.current;if(t!==e)return p(`returning synced token, is null: ${null===t}`),t;let n=await R(d)??null;return null!==n?(E(!0),await L({refreshToken:n}).finally(()=>{E(!1)}),p(`returning retrieved token, is null: ${null===t}`),b.current):(E(!1),p("returning null, there is no refresh token"),null)})}return b.current},[L,T,R]),$=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(void 0===o)throw Error("`localStorage` is not available in this environment, set the `storage` prop on `ConvexAuthProvider`!");let e=async()=>{let e=await R(c)??null;p(`retrieved token from storage, is null: ${null===e}`),await O({shouldStore:!1,tokens:null===e?null:{token:e}})};if(void 0!==t){let n=R(h),r=n=>{if(!n||t._timeFetched>+n){let{token:e,refreshToken:n}=t._state;A(h,t._timeFetched.toString()),O({tokens:null===e||null===n?null:{token:e,refreshToken:n},shouldStore:!0})}else e()};n instanceof Promise?n.then(r):r(n);return}let n=void 0!==window?.location?new URLSearchParams(window.location.search).get("code"):null;if($.current||n){if(n&&!$.current){$.current=!0;let e=new URL(window.location.href);e.searchParams.delete("code"),(async()=>{await w(e.pathname+e.search+e.hash),await N(void 0,{code:n}),$.current=!1})()}}else e()},[e,R]);let U=(0,l.useMemo)(()=>({signIn:N,signOut:T}),[N,T]),F=null!==S,J=(0,l.useMemo)(()=>({isLoading:m,isAuthenticated:F,fetchAccessToken:j}),[j,m,F]);return(0,r.jsx)(i.Provider,{value:J,children:(0,r.jsx)(a.Provider,{value:U,children:(0,r.jsx)(u.Provider,{value:S,children:g})})})}async function f(e,t){let n=window?.navigator?.locks;return void 0!==n?await n.request(e,t):await m(e,t)}function w(e){void 0===globalThis.__convexAuthMutexes&&(globalThis.__convexAuthMutexes={});let t=globalThis.__convexAuthMutexes[e];return void 0===t&&(globalThis.__convexAuthMutexes[e]={currentlyRunning:null,waiting:[]}),t=globalThis.__convexAuthMutexes[e]}function g(e,t){globalThis.__convexAuthMutexes[e]=t}async function b(e,t){let n=w(e);null===n.currentlyRunning?g(e,{currentlyRunning:t().finally(()=>{let t=w(e).waiting.shift();w(e).currentlyRunning=null,g(e,{...w(e),currentlyRunning:void 0===t?null:b(e,t)})}),waiting:[]}):g(e,{...n,waiting:[...n.waiting,t]})}async function m(e,t){return new Promise((n,r)=>{b(e,()=>t().then(e=>n(e)).catch(e=>r(e)))})}function k(e,t,n){window.addEventListener?.(e,t,n)}function y(e,t,n){window.removeEventListener?.(e,t,n)}}},e=>{var t=t=>e(e.s=t);e.O(0,[82,775,173,441,517,358],()=>t(8055)),_N_E=e.O()}]);