"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{8473:(e,t,n)=>{n.d(t,{As:()=>u,OJ:()=>v,eB:()=>i});var l=n(5155),r=n(2115);let i=(0,r.createContext)(void 0),a=(0,r.createContext)(void 0);function u(){return(0,r.useContext)(a)}let o=(0,r.createContext)(null),s="__convexAuthOAuthVerifier",c="__convexAuthJWT",d="__convexAuthRefreshToken",f="__convexAuthServerStateFetchTime";function v({client:e,serverState:t,onChange:n,storage:u,storageNamespace:v,replaceURL:g,children:w}){let y=(0,r.useRef)(t?._state.token??null),[m,_]=(0,r.useState)(null===y.current),[b,x]=(0,r.useState)(y.current),C=e.verbose??!1,S=(0,r.useCallback)(e=>{C&&console.debug(`${new Date().toISOString()} ${e}`)},[C]),{storageSet:A,storageGet:R,storageRemove:I,storageKey:$}=function(e,t){let n=function(){let[e,t]=(0,r.useState)({});return()=>({getItem:t=>e[t],setItem:(e,n)=>{t(t=>({...t,[e]:n}))},removeItem:e=>{t(t=>{let{[e]:n,...l}=t;return l})}})}(),l=(0,r.useMemo)(()=>e??n(),[e]),i=t.replace(/[^a-zA-Z0-9]/g,""),a=(0,r.useCallback)(e=>`${e}_${i}`,[t]);return{storageSet:(0,r.useCallback)((e,t)=>l.setItem(a(e),t),[l,a]),storageGet:(0,r.useCallback)(e=>l.getItem(a(e)),[l,a]),storageRemove:(0,r.useCallback)(e=>l.removeItem(a(e)),[l,a]),storageKey:a}}(u,v),[E,j]=(0,r.useState)(!1),O=(0,r.useCallback)(async e=>{let t;let l=null!==y.current;if(null===e.tokens)y.current=null,e.shouldStore&&(await I(c),await I(d)),t=null;else{let{token:n}=e.tokens;if(y.current=n,e.shouldStore){let{refreshToken:t}=e.tokens;await A(c,n),await A(d,t)}t=n}l!==(null!==t)&&await n?.(),x(t),_(!1)},[A,I]);(0,r.useEffect)(()=>{let e=async e=>{if(E)return e.preventDefault(),e.returnValue=!0,"Are you sure you want to leave? Your changes may not be saved."};return p("beforeunload",e),()=>{k("beforeunload",e)}}),(0,r.useEffect)(()=>{let e=e=>{(async()=>{if(e.storageArea===u&&e.key===$(c)){let t=e.newValue;S(`synced access token, is null: ${null===t}`),await O({shouldStore:!1,tokens:null===t?null:{token:t}})}})()};return p("storage",e),()=>k("storage",e)},[O]);let P=(0,r.useCallback)(async t=>{let{tokens:n}=await e.unauthenticatedCall("auth:signIn","code"in t?{params:{code:t.code},verifier:t.verifier}:t);return S(`retrieved tokens, is null: ${null===n}`),await O({shouldStore:!0,tokens:n??null}),null!==n},[e,O]),T=(0,r.useCallback)(async(t,n)=>{let l=n instanceof FormData?Array.from(n.entries()).reduce((e,[t,n])=>(e[t]=n,e),{}):n??{},r=await R(s)??void 0;await I(s);let i=await e.authenticatedCall("auth:signIn",{provider:t,params:l,verifier:r});if(void 0!==i.redirect){let e=new URL(i.redirect);return await A(s,i.verifier),void 0!==window.location&&(window.location.href=e.toString()),{signingIn:!1,redirect:e}}if(void 0!==i.tokens){let{tokens:e}=i;return S(`signed in and got tokens, is null: ${null===e}`),await O({shouldStore:!0,tokens:e}),{signingIn:null!==i.tokens}}return{signingIn:!1}},[e,O,R]),M=(0,r.useCallback)(async()=>{try{await e.authenticatedCall("auth:signOut")}catch(e){}S("signed out, erasing tokens"),await O({shouldStore:!0,tokens:null})},[O,e]),N=(0,r.useCallback)(async({forceRefreshToken:e})=>{if(e){let e=y.current;return await h(d,async()=>{let t=y.current;if(t!==e)return S(`returning synced token, is null: ${null===t}`),t;let n=await R(d)??null;return null!==n?(j(!0),await P({refreshToken:n}).finally(()=>{j(!1)}),S(`returning retrieved token, is null: ${null===t}`),y.current):(j(!1),S("returning null, there is no refresh token"),null)})}return y.current},[P,M,R]),V=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(void 0===u)throw Error("`localStorage` is not available in this environment, set the `storage` prop on `ConvexAuthProvider`!");let e=async()=>{let e=await R(c)??null;S(`retrieved token from storage, is null: ${null===e}`),await O({shouldStore:!1,tokens:null===e?null:{token:e}})};if(void 0!==t){let n=R(f),l=n=>{if(!n||t._timeFetched>+n){let{token:e,refreshToken:n}=t._state;A(f,t._timeFetched.toString()),O({tokens:null===e||null===n?null:{token:e,refreshToken:n},shouldStore:!0})}else e()};n instanceof Promise?n.then(l):l(n);return}let n=void 0!==window?.location?new URLSearchParams(window.location.search).get("code"):null;if(V.current||n){if(n&&!V.current){V.current=!0;let e=new URL(window.location.href);e.searchParams.delete("code"),(async()=>{await g(e.pathname+e.search+e.hash),await T(void 0,{code:n}),V.current=!1})()}}else e()},[e,R]);let D=(0,r.useMemo)(()=>({signIn:T,signOut:M}),[T,M]),F=null!==b,L=(0,r.useMemo)(()=>({isLoading:m,isAuthenticated:F,fetchAccessToken:N}),[N,m,F]);return(0,l.jsx)(a.Provider,{value:L,children:(0,l.jsx)(i.Provider,{value:D,children:(0,l.jsx)(o.Provider,{value:b,children:w})})})}async function h(e,t){let n=window?.navigator?.locks;return void 0!==n?await n.request(e,t):await m(e,t)}function g(e){void 0===globalThis.__convexAuthMutexes&&(globalThis.__convexAuthMutexes={});let t=globalThis.__convexAuthMutexes[e];return void 0===t&&(globalThis.__convexAuthMutexes[e]={currentlyRunning:null,waiting:[]}),t=globalThis.__convexAuthMutexes[e]}function w(e,t){globalThis.__convexAuthMutexes[e]=t}async function y(e,t){let n=g(e);null===n.currentlyRunning?w(e,{currentlyRunning:t().finally(()=>{let t=g(e).waiting.shift();g(e).currentlyRunning=null,w(e,{...g(e),currentlyRunning:void 0===t?null:y(e,t)})}),waiting:[]}):w(e,{...n,waiting:[...n.waiting,t]})}async function m(e,t){return new Promise((n,l)=>{y(e,()=>t().then(e=>n(e)).catch(e=>l(e)))})}function p(e,t,n){window.addEventListener?.(e,t,n)}function k(e,t,n){window.removeEventListener?.(e,t,n)}},3838:(e,t,n)=>{n.d(t,{BG:()=>i}),n(5155),n(9161),n(4775);var l=n(2115),r=n(8473);function i(){return(0,l.useContext)(r.eB)}},4707:(e,t,n)=>{n.d(t,{DX:()=>u,TL:()=>a,Dc:()=>s});var l=n(2115);function r(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var i=n(5155);function a(e){let t=function(e){let t=l.forwardRef((e,t)=>{let{children:n,...i}=e;if(l.isValidElement(n)){let e,a;let u=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.props.ref:n.props.ref||n.ref,o=function(e,t){let n={...t};for(let l in t){let r=e[l],i=t[l];/^on[A-Z]/.test(l)?r&&i?n[l]=(...e)=>{i(...e),r(...e)}:r&&(n[l]=r):"style"===l?n[l]={...r,...i}:"className"===l&&(n[l]=[r,i].filter(Boolean).join(" "))}return{...e,...n}}(i,n.props);return n.type!==l.Fragment&&(o.ref=t?function(...e){return t=>{let n=!1,l=e.map(e=>{let l=r(e,t);return n||"function"!=typeof l||(n=!0),l});if(n)return()=>{for(let t=0;t<l.length;t++){let n=l[t];"function"==typeof n?n():r(e[t],null)}}}}(t,u):u),l.cloneElement(n,o)}return l.Children.count(n)>1?l.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),n=l.forwardRef((e,n)=>{let{children:r,...a}=e,u=l.Children.toArray(r),o=u.find(c);if(o){let e=o.props.children,r=u.map(t=>t!==o?t:l.Children.count(e)>1?l.Children.only(null):l.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...a,ref:n,children:l.isValidElement(e)?l.cloneElement(e,void 0,r):null})}return(0,i.jsx)(t,{...a,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}var u=a("Slot"),o=Symbol("radix.slottable");function s(e){let t=({children:e})=>(0,i.jsx)(i.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=o,t}function c(e){return l.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}},1027:(e,t,n)=>{n.d(t,{F:()=>a});var l=n(3463);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,i=l.$,a=(e,t)=>n=>{var l;if((null==t?void 0:t.variants)==null)return i(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:a,defaultVariants:u}=t,o=Object.keys(a).map(e=>{let t=null==n?void 0:n[e],l=null==u?void 0:u[e];if(null===t)return null;let i=r(t)||r(l);return a[e][i]}),s=n&&Object.entries(n).reduce((e,t)=>{let[n,l]=t;return void 0===l||(e[n]=l),e},{});return i(e,o,null==t?void 0:null===(l=t.compoundVariants)||void 0===l?void 0:l.reduce((e,t)=>{let{class:n,className:l,...r}=t;return Object.entries(r).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...u,...s}[t]):({...u,...s})[t]===n})?[...e,n,l]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}}}]);